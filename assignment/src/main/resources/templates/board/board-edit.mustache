<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>게시글 수정</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/dracula.min.css">

    <style>
        :root {
            --color-canvas-default: #0d1117; --color-canvas-subtle: #161b22; --color-border-default: #30363d;
            --color-fg-default: #e6edf3; --color-fg-muted: #7d8590; --color-accent-fg: #1f6feb;
            --color-accent-emphasis: #238636; --color-danger-fg: #f85149; --border-radius-medium: 6px;
        }
        body { font-family: -apple-system, sans-serif; background-color: var(--color-canvas-default); color: var(--color-fg-default); }
        .container { max-width: 900px; margin: 24px auto; padding: 24px; background-color: var(--color-canvas-subtle); border: 1px solid var(--color-border-default); border-radius: var(--border-radius-medium); }
        h1 { margin-top: 0; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 0.5rem; }
        .form-control { width: 100%; padding: 8px 12px; background: var(--color-canvas-default); border: 1px solid var(--color-border-default); border-radius: var(--border-radius-medium); color: var(--color-fg-default); font-size: 14px; box-sizing: border-box; }
        .form-actions { margin-top: 1.5rem; display: flex; gap: 0.5rem; justify-content: flex-end; }
        .btn { border: 1px solid var(--color-border-default); padding: 8px 16px; border-radius: 6px; cursor: pointer; background-color: #21262d; color: #e6edf3; font-weight: 500; text-decoration: none; }
        .btn-primary { background-color: var(--color-accent-emphasis); border-color: var(--color-accent-emphasis); color: white; }

        /* [추가] CodeMirror 에디터 스타일 커스터마이징 */
        .CodeMirror {
            border: 1px solid var(--color-border-default);
            border-radius: var(--border-radius-medium);
            font-size: 14px;
            height: 400px; /* 에디터 기본 높이 */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>게시글 수정</h1>
        
        {{#board}}
        <form id="editForm" action="/board/edit" method="post">
            <input type="hidden" name="boardNo" value="{{boardNo}}">
            <input type="hidden" name="writerId" value="{{writerId}}">
            <input type="hidden" name="groupNo" value="{{#groupNo}}{{groupNo}}{{/groupNo}}">
            <input type="hidden" name="createDate" value="{{createDate}}">
            
            <div class="form-group">
                <label for="boardTitle">제목</label>
                <input type="text" id="boardTitle" name="boardTitle" value="{{boardTitle}}" class="form-control" required>
            </div>

            <div class="form-group">
                <label for="categorySelect">카테고리</label>
                <select name="boardCategory" id="categorySelect" class="form-control" required>
                    <option value="JAVA">Java</option>
                    <option value="SPRING">Spring</option>
                    <option value="ALGORITHM">Algorithm</option>
                    <option value="DATABASE">Database</option>
                    <option value="JPA">JPA</option>
                    <option value="OTHER">기타</option>
                </select>
            </div>
            
            <div class="form-group">
                 <label>작성자</label>
                 <p style="padding: 8px 12px; background-color: #0d1117; border-radius: 6px;">{{writerId}} (수정 불가)</p>
            </div>
            
            <div class="form-group">
                <label for="passStatusSelect">통과여부</label>
                <select name="passStatus" id="passStatusSelect" class="form-control" required>
                    <option value="Y">통과</option>
                    <option value="N">대기</option>
                </select>
            </div>

            <div class="form-group">
                <label for="codeEditor">코드 내용</label>
                <textarea name="boardContent" id="codeEditor">{{boardContent}}</textarea>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn" onclick="history.back()">취소</button>
                <input type="submit" class="btn btn-primary" value="수정완료">
            </div>
        </form>
        {{/board}}
        
        {{^board}}
        <p>존재하지 않는 게시글입니다.</p>
        <button type="button" class="btn" onclick="history.back()">돌아가기</button>
        {{/board}}
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/clike/clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/matchbrackets.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 기존 select 옵션 설정 로직은 그대로 유지
            const boardData = {{#board}}{{{.}}}{{/board}};
            if (boardData) {
                document.getElementById('categorySelect').value = boardData.boardCategory || 'JAVA';
                document.getElementById('passStatusSelect').value = boardData.passStatus || 'N';
                
                // [추가] 3. CodeMirror 에디터 초기화
                var editor = CodeMirror.fromTextArea(document.getElementById("codeEditor"), {
                    lineNumbers: true,         // 라인 넘버 표시 (요청사항)
                    mode: "text/x-java",       // 언어 모드 설정 (Java 문법 하이라이팅)
                    theme: "dracula",          // 테마 설정 (어두운 테마)
                    matchBrackets: true,       // 괄호 쌍 하이라이팅
                    indentUnit: 4,             // 들여쓰기 단위
                    smartIndent: true,         // 스마트 들여쓰기
                });

                // [추가] 4. form 전송 전에 CodeMirror의 내용을 원래 textarea에 반영
                var form = document.getElementById('editForm');
                form.addEventListener('submit', function() {
                    editor.save(); // CodeMirror의 내용을 원래 textarea로 복사
                });
            }
        });
    </script>
</body>
</html>