package com.assignment.like.controller;

import com.assignment.like.service.LikeService;
import jakarta.servlet.http.HttpSession;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.Map;

@RestController // 이 컨트롤러의 모든 메소드는 @ResponseBody가 적용된 것처럼 동작합니다.
@RequestMapping("/api/boards/{boardNo}/like")
public class LikeController {

    @Autowired
    private LikeService likeService;

    @PostMapping
    public ResponseEntity<?> toggleLike(@PathVariable("boardNo") int boardNo, HttpSession session) {
        String memberId = (String) session.getAttribute("loginId");
        if (memberId == null) {
            // 로그인하지 않은 사용자는 401 Unauthorized 에러를 반환
            return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body("로그인이 필요합니다.");
        }

        try {
            Map<String, Object> result = likeService.toggleLike(boardNo, memberId);
            return ResponseEntity.ok(result);
        } catch (Exception e) {
            // 서버 내부 오류 발생 시 500 Internal Server Error 반환
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body("오류가 발생했습니다.");
        }
    }
}