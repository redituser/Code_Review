<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>새 코드 리뷰 요청</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/material-darker.min.css">

    <style>
        /* 기존 프로젝트의 GitHub Primer 스타일 변수를 활용하여 일관성 유지 */
        :root {
            --color-canvas-default: #0d1117;
            --color-canvas-subtle: #161b22;
            --color-border-default: #30363d;
            --color-fg-default: #e6edf3;
            --color-fg-muted: #7d8590;
            --color-accent-fg: #1f6feb;
            --color-accent-emphasis: #238636;
            --color-accent-emphasis-hover: #2ea043;
            --font-family-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --border-radius-medium: 6px;
        }

        body {
            font-family: var(--font-family-sans);
            background-color: var(--color-canvas-default);
            color: var(--color-fg-default);
            line-height: 1.5;
            margin: 0;
            padding: 24px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .form-header {
            padding-bottom: 12px;
            border-bottom: 1px solid var(--color-border-default);
            margin-bottom: 24px;
        }

        h1 {
            font-size: 24px;
            font-weight: 600;
            margin: 0;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .form-control,
        .form-select {
            width: 100%;
            padding: 8px 12px;
            background: var(--color-canvas-subtle);
            border: 1px solid var(--color-border-default);
            border-radius: var(--border-radius-medium);
            color: var(--color-fg-default);
            font-size: 14px;
            box-sizing: border-box; /* 패딩과 테두리가 너비에 포함되도록 설정 */
        }

        .form-control:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--color-accent-fg);
            box-shadow: 0 0 0 3px rgba(31, 111, 235, 0.3);
        }

        .form-radio-group label {
            font-weight: normal;
            margin-right: 16px;
        }
        
        /* CodeMirror 에디터 스타일 커스텀 */
        .CodeMirror {
            border: 1px solid var(--color-border-default);
            border-radius: var(--border-radius-medium);
            height: 400px; /* 에디터 높이 */
            font-size: 14px;
        }
        .CodeMirror-focused {
            border-color: var(--color-accent-fg);
            box-shadow: 0 0 0 3px rgba(31, 111, 235, 0.3);
        }

        .form-actions {
            margin-top: 24px;
            display: flex;
            justify-content: flex-end; /* 버튼을 오른쪽으로 정렬 */
            gap: 8px;
        }

        .btn {
            border: 1px solid var(--color-border-default);
            padding: 6px 16px;
            border-radius: var(--border-radius-medium);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: background-color 0.2s;
            background-color: #21262d;
            color: var(--color-fg-default);
        }
        .btn:hover {
            background-color: #30363d;
        }
        .btn-primary {
            background-color: var(--color-accent-emphasis);
            color: #ffffff;
            border-color: var(--color-accent-emphasis);
        }
        .btn-primary:hover {
            background-color: var(--color-accent-emphasis-hover);
        }
    </style>
</head>
<body>
    <div class="container">
        <form action="/board/write" method="post">
            <div class="form-header">
                <h1>새 코드 리뷰 요청</h1>
            </div>

            <div class="form-group">
                <label>게시물 종류</label>
                <div class="form-radio-group">
                    <label><input type="radio" name="boardType" value="PUBLIC" checked onchange="toggleGroupOptions()"> 공개 게시물</label>
                    <label><input type="radio" name="boardType" value="REVIEW" onchange="toggleGroupOptions()"> 코드 리뷰</label>
                </div>
            </div>

            <div class="form-group">
                <label for="board-title">제목</label>
                <input type="text" id="board-title" name="boardTitle" class="form-control" required>
            </div>

            <div id="group-select-row" class="form-group" style="display:none;">
                <label for="group-select">리뷰 요청 그룹</label>
                <select name="groupNo" id="group-select" class="form-select">
                    <option value="">그룹을 선택하세요</option>
                </select>
            </div>

            <div class="form-group">
                <label for="board-category">카테고리</label>
                <select name="boardCategory" id="board-category" class="form-select" required>
                    <option value="">선택하세요</option>
                    <option value="JAVA">Java</option>
                    <option value="SPRING">Spring</option>
                    <option value="ALGORITHM">Algorithm</option>
                    <option value="DATABASE">Database</option>
                    <option value="JPA">JPA</option>
                    <option value="OTHER">기타</option>
                </select>
            </div>

            <div id="description-row" class="form-group" style="display:none;">
                <label for="board-description">설명</label>
                <textarea name="boardDescription" id="board-description" class="form-control" rows="8" placeholder="이 코드의 변경사항과 리뷰 요청사항을 자세히 적어주세요. (Markdown 지원)"></textarea>
            </div>

            <div class="form-group">
                <label for="code-content-textarea">코드 내용</label>
                <textarea id="code-content-textarea" name="boardContent"></textarea>
            </div>

            <div class="form-actions">
                <button type="button" class="btn" onclick="history.back()">취소</button>
                <button type="submit" class="btn btn-primary">작성완료</button>
            </div>
        </form>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/clike/clike.min.js"></script> <script>
        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', () => {
            loadUserGroups();
            initializeCodeEditor();
        });

        // CodeMirror 에디터를 초기화하는 함수
        function initializeCodeEditor() {
            const textarea = document.getElementById('code-content-textarea');
            const editor = CodeMirror.fromTextArea(textarea, {
                lineNumbers: true,         // 줄 번호 표시
                mode: "text/x-java",       // 언어 모드 (Java, C++, C# 등)
                theme: "material-darker",  // 테마
                matchBrackets: true,       // 괄호 짝 맞춤
                autoCloseBrackets: true,   // 괄호 자동 닫기
                indentUnit: 4,             // 들여쓰기 단위
                tabSize: 4
            });

            // CodeMirror의 내용이 변경될 때마다 원래의 textarea에 값을 업데이트
            editor.on('change', () => {
                textarea.value = editor.getValue();
            });
        }

        function toggleGroupOptions() {
            // 이 함수는 이전 답변과 동일합니다.
            const boardType = document.querySelector('input[name="boardType"]:checked').value;
            const groupRow = document.getElementById('group-select-row');
            const descriptionRow = document.getElementById('description-row');
            const groupSelect = document.getElementById('group-select');

            if (boardType === 'REVIEW') {
                groupRow.style.display = 'block';
                descriptionRow.style.display = 'block';
                groupSelect.required = true;
            } else {
                groupRow.style.display = 'none';
                descriptionRow.style.display = 'none';
                groupSelect.required = false;
                groupSelect.value = ''; // 선택값 초기화
            }
        }

        async function loadUserGroups() {
            // 이 함수는 이전 답변과 동일합니다.
            const groupSelect = document.getElementById('group-select');
            try {
                const response = await fetch('/api/my-groups');
                if (!response.ok) throw new Error('그룹 목록 로딩 실패');
                const myGroups = await response.json();

                groupSelect.innerHTML = '<option value="">그룹을 선택하세요</option>';
                myGroups.forEach(group => {
                    const option = document.createElement('option');
                    option.value = group.groupNo;
                    option.textContent = group.groupName;
                    groupSelect.appendChild(option);
                });
            } catch (error) {
                console.error(error);
                groupSelect.innerHTML = '<option value="">그룹 로딩 실패</option>';
            }
        }
    </script>
</body>
</html>